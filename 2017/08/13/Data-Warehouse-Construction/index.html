<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="CgWpgpEd7fSixhMFnnAhPIXT3nCIz9VbArCcXf9ZC0c" />














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Data-Warehouse," />





  <link rel="alternate" href="/atom.xml" title="Coding and Talking" type="application/atom+xml" />






<meta name="description" content="本文主要介绍数据仓库的起源和基本搭建。">
<meta name="keywords" content="Data-Warehouse">
<meta property="og:type" content="article">
<meta property="og:title" content="数据仓库建设">
<meta property="og:url" content="http://moqimoqidea.github.io/2017/08/13/Data-Warehouse-Construction/index.html">
<meta property="og:site_name" content="Coding and Talking">
<meta property="og:description" content="本文主要介绍数据仓库的起源和基本搭建。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/01-Shopping-Website-Order.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/02-OLTP-AND-OLAP.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/03-DWBI.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/04-Rule.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/05-Exception.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/06-Mail.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/07-Metadata.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/08-Metadata-And-Another.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/09-Data-Warehouse-Hierarchy.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/10-Data-Warehouse-Model-Architecture.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/11-Data-Warehouse-Model-Hierarchy.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/12-Business-And-DW.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/13-Dimension-Of-DW.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/14-Entity-Of-Model.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/15-Star-Model.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/16-Snowflake-Model.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/17-Snowflake-Model.png?raw=true">
<meta property="og:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/18-Star-Model.png?raw=true">
<meta property="og:updated_time" content="2018-11-25T14:07:51.504Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="数据仓库建设">
<meta name="twitter:description" content="本文主要介绍数据仓库的起源和基本搭建。">
<meta name="twitter:image" content="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/01-Shopping-Website-Order.png?raw=true">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://moqimoqidea.github.io/2017/08/13/Data-Warehouse-Construction/"/>





  <title>数据仓库建设 | Coding and Talking</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-120200111-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Coding and Talking</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://moqimoqidea.github.io/2017/08/13/Data-Warehouse-Construction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="moqi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/39821951?s=400&u=65c6d8145d7b591ca2051e7082fd842b56e62567&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coding and Talking">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">数据仓库建设</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-13T10:03:25+08:00">
                2017-08-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/13/Data-Warehouse-Construction/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/13/Data-Warehouse-Construction/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  11,811
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  40
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>本文主要介绍数据仓库的起源和基本搭建。</p>
<a id="more"></a> 
<h1 id="什么是数据仓库"><a href="#什么是数据仓库" class="headerlink" title="什么是数据仓库"></a>什么是数据仓库</h1><p>数据仓库，英文名称为Data Warehouse，可简写为DW或DWH。数据仓库，是为企业所有级别的决策制定过程，提供所有类型数据支持的战略集合。它出于分析性报告和决策支持目的而创建。 为需要业务智能的企业，提供指导业务流程改进、监视时间、成本、质量以及控制。<br>数据仓库能干什么？</p>
<ol>
<li>年度销售目标的指定，需要根据以往的历史报表进行决策，不能拍脑袋。</li>
<li>如何优化业务流程？<ol>
<li>案例1：某公司需要对APP进行推广，考核的主要目标是下载安装，有些第三方渠道会对这些数据造假，比如某个渠道在凌晨批量下载，点赞操作，操作步骤一致。通过数据分析，分析出应用的名称和安装时间，来判断一个渠道的是否优质、是否作假。</li>
<li>案例2：一个电商网站订单的完成包括：浏览、下单、支付、物流，其中物流环节可能和中通、申通、韵达等快递公司合作。快递公司每派送一个订单，都会有订单派送的确认时间，可以根据订单派送时间来分析哪个快递公司比较快捷高效，从而选择与哪些快递公司合作，剔除哪些快递公司，增加用户友好型。</li>
</ol>
</li>
</ol>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/01-Shopping-Website-Order.png?raw=true" alt="01-Shopping-Website-Order"></p>
<h1 id="数据仓库的特点"><a href="#数据仓库的特点" class="headerlink" title="数据仓库的特点"></a>数据仓库的特点</h1><h2 id="数据是面向主题的"><a href="#数据是面向主题的" class="headerlink" title="数据是面向主题的"></a>数据是面向主题的</h2><p>与传统数据库面向应用进行数据组织的特点相对应，数据仓库中的数据是面向主题进行组织的。什么是主题呢？首先，主题是一个抽象的概念，是较高层次上企业信息系统中的数据综合、归类并进行分析利用的抽象。在逻辑意义上，它是对应企业中某一宏观分析领域所涉及的分析对象。面向主题的数据组织方式，就是在较高层次上对分析对象的数据的一个完整、一致的描述，能完整、统一地刻划各个分析对象所涉及的企业的各项数据，以及数据之间的联系。所谓较高层次是相对面向应用的数据组织方式而言的，是指按照主题进行数据组织的方式具有更高的数据抽象级别。</p>
<h2 id="数据是集成的"><a href="#数据是集成的" class="headerlink" title="数据是集成的"></a>数据是集成的</h2><p>数据仓库的数据是从原有的分散的数据库数据抽取来的。操作型数据与DSS分析型数据之间差别甚大。第一，数据仓库的每一个主题所对应的源数据在原有的各分散数据库中有许多重复和不一致的地方，且来源于不同的联机系统的数据都和不同的应用逻辑捆绑在一起；第二，数据仓库中的综合数据不能从原有的数据库系统直接得到。因此在数据进入数据仓库之前，必然要经过统一与综合，这一步是数据仓库建设中最关键、最复杂的一步，所要完成的工作有：</p>
<ol>
<li>要统一源数据中所有矛盾之处，如字段的同名异义、异名同义、单位不统一、字长不一致，等等。</li>
<li><p>进行数据综合和计算。数据仓库中的数据综合工作可以在从原有数据库抽取 数据时生成，但许多是在数据仓库内部生成的，即进入数据仓库以后进行综合生成的。</p>
<h2 id="数据是不可更新的"><a href="#数据是不可更新的" class="headerlink" title="数据是不可更新的"></a>数据是不可更新的</h2><p>数据仓库的数据主要供企业决策分析之用，所涉及的数据操作主要是数据查询，一般情况下并不进行修改操作。数据仓库的数据反映的是一段相当长的时间内历史数据的内容，是不同时点的数据库快照的集合，以及基于这些快照进行统计、综合和重组的导出数据，而不是联机处理的数据。数据库中进行联机处理的数据经过集成输入到数据仓库中，一旦数据仓库存放的数据已经超过数据仓库的数据存储期限，这些数据将从当前的数据仓库中删去。因为数据仓库只进行数据查询操作，所以数据仓库管理系统相比数据库管理系统而言要简单得多。数据库管理系统中许多技术难点，如完整性保护、并发控制等等，在数据仓库的管理中几乎可以省去。但是由于数据仓库的查询数据量往往很大，所以就对数据查询提出了更高的要求，它要求采用各种复杂的索引技术；同时由于数据仓库面向的是商业企业的高层管理者，他们会对数据查询的界面友好性和数据表示提出更高的要求。</p>
<h2 id="数据是随时间不断变化的"><a href="#数据是随时间不断变化的" class="headerlink" title="数据是随时间不断变化的"></a>数据是随时间不断变化的</h2><p>数据仓库中的数据不可更新是针对应用来说的，也就是说，数据仓库的用户进行分析处理时是不进行数据更新操作的。但并不是说，在从数据集成输入数据仓库开始到最终被删除的整个数据生存周期中，所有的数据仓库数据都是永远不变的。<br>​    数据仓库的数据是随时间的变化而不断变化的，这是数据仓库数据的第四个特征。这一特征表现在以下3方面：</p>
</li>
<li><p>数据仓库随时间变化不断增加新的数据内容。数据仓库系统必须不断捕捉OLTP数据库中变化的数据，追加到数据仓库中去，也就是要不断地生成OLTP数据库的快照，经统一集成后增加到数据仓库中去；但对于确实不再变化的数据库快照，如果捕捉到新的变化数据，则只生成一个新的数据库快照增加进去，而不会对原有的数据库快照进行修改。</p>
</li>
<li>数据仓库随时间变化不断删去旧的数据内容。数据仓库的数据也有存储期限，一旦超过了这一期限，过期数据就要被删除。只是数据仓库内的数据时限要远远长于操作型环境中的数据时限。在操作型环境中一般只保存有60~90天的数据，而在数据仓库中则需要保存较长时限的数据（如5~10年），以适应DSS进行趋势分析的要求。</li>
<li>数据仓库中包含有大量的综合数据，这些综合数据中很多跟时间有关，如数据经常按照时间段进行综合，或隔一定的时间片进行抽样等等。这些数据要随着时间的变化不断地进行重新综合。因此，数据仓库的数据特征都包含时间项，以标明数据的历史时期。</li>
</ol>
<h1 id="数据仓库的发展历程"><a href="#数据仓库的发展历程" class="headerlink" title="数据仓库的发展历程"></a>数据仓库的发展历程</h1><p>数据仓库的发展大致经历了这样的三个过程：</p>
<h2 id="简单报表阶段"><a href="#简单报表阶段" class="headerlink" title="简单报表阶段"></a>简单报表阶段</h2><p>这个阶段，系统的主要目标是解决一些日常的工作中业务人员需要的报表，以及生成一些简单的能够帮助领导进行决策所需要的汇总数据。这个阶段的大部分表现形式为数据库和前端报表工具。</p>
<h2 id="数据集市阶段"><a href="#数据集市阶段" class="headerlink" title="数据集市阶段"></a>数据集市阶段</h2><p>这个阶段，主要是根据某个业务部门的需要，进行一定的数据的采集，整理，按照业务人员的需要，进行多维报表的展现，能够提供对特定业务指导的数据，并且能够提供特定的领导决策数据。</p>
<h2 id="数据仓库阶段"><a href="#数据仓库阶段" class="headerlink" title="数据仓库阶段"></a>数据仓库阶段</h2><p>这个阶段，主要是按照一定的数据模型，对整个企业的数据进行采集，整理，并且能够按照各个业务部门的需要，提供跨部门的，完全一致的业务报表数据，能够通过数据仓库生成对对业务具有指导性的数据，同时，为领导决策提供全面的数据支持。</p>
<p>通过数据仓库建设的发展阶段，我们能够看出，数据仓库的建设和数据集市的建设的重要区别就在于数据模型的支持。因此，数据模型的建设，对于我们数据仓库的建设，有着决定性的意义。</p>
<h1 id="数据仓库和数据库的区别"><a href="#数据仓库和数据库的区别" class="headerlink" title="数据仓库和数据库的区别"></a>数据仓库和数据库的区别</h1><p>了解数据库与数据仓库的区别之前，首先掌握三个概念。数据库软件、数据库、数据仓库。<br>数据库软件：是一种软件，可以看得见，可以操作。用来实现数据库逻辑功能。属于物理层。<br>数据库：是一种逻辑概念，用来存放数据的仓库。通过数据库软件来实现。数据库由很多表组成，表是二维的，一张表里可以有很多字段。字段一字排开，对应的数据就一行一行写入表中。数据库的表，在于能够用二维表现多维关系。目前市面上流行的数据库都是二维数据库。如：Oracle、DB2、MySQL、Sybase、MS SQL Server等。<br>数据仓库：是数据库概念的升级。从逻辑上理解，数据库和数据仓库没有区别，都是通过数据库软件实现的存放数据的地方，只不过从数据量来说，数据仓库要比数据库更庞大得多。数据仓库主要用于数据挖掘和数据分析，辅助领导做决策。<br>在IT的架构体系中，数据库是必须存在的。必须要有地方存放数据。比如现在的网购，淘宝，京东等等。物品的存货数量，货品的价格，用户的账户余额之类的。这些数据都是存放在后台数据库中。或者最简单理解，我们现在微博，QQ等账户的用户名和密码。在后台数据库必然有一张user表，字段起码有两个，即用户名和密码，然后我们的数据就一行一行的存在表上面。当我们登录的时候，我们填写了用户名和密码，这些数据就会被传回到后台去，去跟表上面的数据匹配，匹配成功了，你就能登录了。匹配不成功就会报错说密码错误或者没有此用户名等。这个就是数据库，数据库在生产环境就是用来干活的。凡是跟业务应用挂钩的，我们都使用数据库。<br>数据仓库则是BI下的其中一种技术。由于数据库是跟业务应用挂钩的，所以一个数据库不可能装下一家公司的所有数据。数据库的表设计往往是针对某一个应用进行设计的。比如刚才那个登录的功能，这张user表上就只有这两个字段，没有别的字段了。但是这张表符合应用，没有问题。但是这张表不符合分析。比如我想知道在哪个时间段，用户登录的量最多？哪个用户一年购物最多？诸如此类的指标。那就要重新设计数据库的表结构了。对于数据分析和数据挖掘，我们引入数据仓库概念。数据仓库的表结构是依照分析需求，分析维度，分析指标进行设计的。<br>数据库与数据仓库的区别实际讲的是OLTP与OLAP的区别。<br>操作型处理，叫联机事务处理OLTP（On-Line Transaction Processing），也可以称面向交易的处理系统，它是针对具体业务在数据库联机的日常操作，通常对少数记录进行查询、修改。用户较为关心操作的响应时间、数据的安全性、完整性和并发支持的用户数等问题。传统的数据库系统作为数据管理的主要手段，主要用于操作型处理。<br>分析型处理，叫联机分析处理OLAP（On-Line Analytical Processing）一般针对某些主题的历史数据进行分析，支持管理决策。</p>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/02-OLTP-AND-OLAP.png?raw=true" alt="02-OLTP-AND-OLAP"></p>
<h1 id="数据仓库架构分层"><a href="#数据仓库架构分层" class="headerlink" title="数据仓库架构分层"></a>数据仓库架构分层</h1><p>数据仓库标准上可以分为四层：ODS（临时存储层）、PDW（数据仓库层）、DM（数据集市层）、APP（应用层）。</p>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/03-DWBI.png?raw=true" alt="03-DWBI"></p>
<h2 id="ODS层"><a href="#ODS层" class="headerlink" title="ODS层"></a>ODS层</h2><p>为临时存储层，是接口数据的临时存储区域，为后一步的数据处理做准备。一般来说ODS层的数据和源系统的数据是同构的，主要目的是简化后续数据加工处理的工作。从数据粒度上来说ODS层的数据粒度是最细的。ODS层的表通常包括两类，一个用于存储当前需要加载的数据，一个用于存储处理完后的历史数据。历史数据一般保存3-6个月后需要清除，以节省空间。但不同的项目要区别对待，如果源系统的数据量不大，可以保留更长的时间，甚至全量保存；</p>
<h2 id="PDW层"><a href="#PDW层" class="headerlink" title="PDW层"></a>PDW层</h2><p>为数据仓库层，PDW层的数据应该是一致的、准确的、干净的数据，即对源系统数据进行了清洗（去除了杂质）后的数据。这一层的数据一般是遵循数据库第三范式的，其数据粒度通常和ODS的粒度相同。在PDW层会保存BI系统中所有的历史数据，例如保存10年的数据。</p>
<h2 id="DM层"><a href="#DM层" class="headerlink" title="DM层"></a>DM层</h2><p>为数据集市层，这层数据是面向主题来组织数据的，通常是星形或雪花结构的数据。从数据粒度来说，这层的数据是轻度汇总级的数据，已经不存在明细数据了。从数据的时间跨度来说，通常是PDW层的一部分，主要的目的是为了满足用户分析的需求，而从分析的角度来说，用户通常只需要分析近几年（如近三年的数据）的即可。从数据的广度来说，仍然覆盖了所有业务数据。</p>
<h2 id="APP层"><a href="#APP层" class="headerlink" title="APP层"></a>APP层</h2><p>为应用层，这层数据是完全为了满足具体的分析需求而构建的数据，也是星形或雪花结构的数据。从数据粒度来说是高度汇总的数据。从数据的广度来说，则并不一定会覆盖所有业务数据，而是DM层数据的一个真子集，从某种意义上来说是DM层数据的一个重复。从极端情况来说，可以为每一张报表在APP层构建一个模型来支持，达到以空间换时间的目的数据仓库的标准分层只是一个建议性质的标准，实际实施时需要根据实际情况确定数据仓库的分层，不同类型的数据也可能采取不同的分层方法。</p>
<h2 id="为什么要对数据仓库分层"><a href="#为什么要对数据仓库分层" class="headerlink" title="为什么要对数据仓库分层"></a>为什么要对数据仓库分层</h2><ol>
<li>用空间换时间，通过大量的预处理来提升应用系统的用户体验（效率），因此数据仓库会存在大量冗余的数据；</li>
<li>如果不分层的话，如果源业务系统的业务规则发生变化将会影响整个数据清洗过程，工作量巨大。</li>
<li>通过数据分层管理可以简化数据清洗的过程，因为把原来一步的工作分到了多个步骤去完成，相当于把一个复杂的工作拆成了多个简单的工作，把一个大的黑盒变成了一个白盒，每一层的处理逻辑都相对简单和容易理解，这样我们比较容易保证每一个步骤的正确性，当数据发生错误的时候，往往我们只需要局部调整某个步骤即可。</li>
</ol>
<h1 id="数据质量检查"><a href="#数据质量检查" class="headerlink" title="数据质量检查"></a>数据质量检查</h1><p>保证报表数据的正确性、稳定性，通过告警机制尽可能快的发现异常、尽可能快的解决问题。</p>
<p>检查方法：</p>
<ol>
<li>数据行数据的比较。</li>
<li>行数有变化，但是指标有变化。对重点指标进行筛选。</li>
<li>发现问题，及时通知相关模块负责人</li>
</ol>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/04-Rule.png?raw=true" alt="04-Rule"></p>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/05-Exception.png?raw=true" alt="05-Exception"></p>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/06-Mail.png?raw=true" alt="06-Mail"></p>
<h1 id="元数据介绍"><a href="#元数据介绍" class="headerlink" title="元数据介绍"></a>元数据介绍</h1><p>当需要了解某地企业及其提供的服务时，电话黄页的重要性就体现出来了。元数据（Metadata）类似于这样的电话黄页。</p>
<h2 id="元数据的定义"><a href="#元数据的定义" class="headerlink" title="元数据的定义"></a>元数据的定义</h2><p>   数据仓库的元数据是关于数据仓库中数据的数据。它的作用类似于数据库管理系统的数据字典，保存了逻辑数据结构、文件、地址和索引等信息。广义上讲，在数据仓库中，元数据描述了数据仓库内数据的结构和建立方法的数据。</p>
<p>   <img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/07-Metadata.png?raw=true" alt="07-Metadata"></p>
<p>   元数据是数据仓库管理系统的重要组成部分，元数据管理器是企业级数据仓库中的关键组件，贯穿数据仓库构建的整个过程，直接影响着数据仓库的构建、使用和维护。</p>
<ol>
<li>构建数据仓库的主要步骤之一是ETL。这时元数据将发挥重要的作用，它定义了源数据系统到数据仓库的映射、数据转换的规则、数据仓库的逻辑结构、数据更新的规则、数据导入历史记录以及装载周期等相关内容。数据抽取和转换的专家以及数据仓库管理员正是通过元数据高效地构建数据仓库。</li>
<li>用户在使用数据仓库时，通过元数据访问数据，明确数据项的含义以及定制报表。</li>
<li><p>数据仓库的规模及其复杂性离不开正确的元数据管理，包括增加或移除外部数据源，改变数据清洗方法，控制出错的查询以及安排备份等。</p>
<p>元数据可分为技术元数据和业务元数据。技术元数据为开发和管理数据仓库的IT 人员使用，它描述了与数据仓库开发、管理和维护相关的数据，包括数据源信息、数据转换描述、数据仓库模型、数据清洗与更新规则、数据映射和访问权限等。而业务元数据为管理层和业务分析人员服务，从业务角度描述数据，包括商务术语、数据仓库中有什么数据、数据的位置和数据的可用性等，帮助业务人员更好地理解数据仓库中哪些数据是可用的以及如何使用。<br>由上可见，元数据不仅定义了数据仓库中数据的模式、来源、抽取和转换规则等，而且是整个数据仓库系统运行的基础，元数据把数据仓库系统中各个松散的组件联系起来，组成了一个有机的整体，如图所示：</p>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/08-Metadata-And-Another.png?raw=true" alt="08-Metadata-And-Another"></p>
</li>
</ol>
<h2 id="元数据的存储方式"><a href="#元数据的存储方式" class="headerlink" title="元数据的存储方式"></a>元数据的存储方式</h2><p>   元数据有两种常见存储方式：一种是以数据集为基础，每一个数据集有对应的元数据文件，每一个元数据文件包含对应数据集的元数据内容；另一种存储方式是以数据库为基础，即元数据库。其中元数据文件由若干项组成，每一项表示元数据的一个要素，每条记录为数据集的元数据内容。上述存储方式各有优缺点，第一种存储方式的优点是调用数据时相应的元数据也作为一个独立的文件被传输，相对数据库有较强的独立性，在对元数据进行检索时可以利用数据库的功能实现，也可以把元数据文件调到其他数据库系统中操作；不足是如果每一数据集都对应一个元数据文档，在规模巨大的数据库中则会有大量的元数据文件，管理不方便。第二种存储方式下，元数据库中只有一个元数据文件，管理比较方便，添加或删除数据集，只要在该文件中添加或删除相应的记录项即可。在获取某数据集的元数据时，因为实际得到的只是关系表格数据的一条记录，所以要求用户系统可以接受这种特定形式的数据。因此推荐使用元数据库的方式。<br>   元数据库用于存储元数据，因此元数据库最好选用主流的关系数据库管理系统。元数据库还包含用于操作和查询元数据的机制。建立元数据库的主要好处是提供统一的数据结构和业务规则，易于把企业内部的多个数据集市有机地集成起来。目前，一些企业倾向建立多个数据集市，而不是一个集中的数据仓库，这时可以考虑在建立数据仓库（或数据集市）之前，先建立一个用于描述数据、服务应用集成的元数据库，做好数据仓库实施的初期支持工作，对后续开发和维护有很大的帮助。元数据库保证了数据仓库数据的一致性和准确性，为企业进行数据质量管理提供基础。</p>
<h2 id="元数据的作用"><a href="#元数据的作用" class="headerlink" title="元数据的作用"></a>元数据的作用</h2><ol>
<li>描述哪些数据在数据仓库中，帮助决策分析者对数据仓库的内容定位。</li>
<li>定义数据进入数据仓库的方式，作为数据汇总、映射和清洗的指南。</li>
<li>记录业务事件发生而随之进行的数据抽取工作时间安排。</li>
<li>记录并检测系统数据一致性的要求和执行情况。</li>
<li>评估数据质量。</li>
</ol>
<h1 id="什么是数据模型"><a href="#什么是数据模型" class="headerlink" title="什么是数据模型"></a>什么是数据模型</h1><p>数据模型是抽象描述现实世界的一种工具和方法，是通过抽象的实体及实体之间联系的形式，来表示现实世界中事务的相互关系的一种映射。在这里，数据模型表现的抽象的是实体和实体之间的关系，通过对实体和实体之间关系的定义和描述，来表达实际的业务中具体的业务关系。<br>数据仓库模型是数据模型中针对特定的数据仓库应用系统的一种特定的数据模型，一般的来说，我们数据仓库模型分为几下几个层次，如图所示：</p>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/09-Data-Warehouse-Hierarchy.png?raw=true" alt="09-Data-Warehouse-Hierarchy"></p>
<p>通过上面的图形，我们能够很容易的看出在整个数据仓库得建模过程中，我们需要经历一般四个过程：</p>
<ul>
<li>业务建模，生成业务模型，主要解决业务层面的分解和程序化。</li>
<li>领域建模，生成领域模型，主要是对业务模型进行抽象处理，生成领域概念模型。</li>
<li>逻辑建模，生成逻辑模型，主要是将领域模型的概念实体以及实体之间的关系进行数据库层次的逻辑化。</li>
<li>物理建模，生成物理模型，主要解决，逻辑模型针对不同关系型数据库的物理化以及性能等一些具体的技术问题。</li>
</ul>
<p>因此，在整个数据仓库的模型的设计和架构中，既涉及到业务知识，也涉及到了具体的技术，我们既需要了解丰富的行业经验，同时，也需要一定的信息技术来帮助我们实现我们的数据模型，最重要的是，我们还需要一个非常适用的方法论，来指导我们自己针对我们的业务进行抽象，处理，生成各个阶段的模型。</p>
<h1 id="为什么需要数据模型"><a href="#为什么需要数据模型" class="headerlink" title="为什么需要数据模型"></a>为什么需要数据模型</h1><p>通过数据仓库建设的发展阶段，我们能够看出，数据仓库的建设和数据集市的建设的重要区别就在于数据模型的支持。因此，数据模型的建设，对于我们数据仓库的建设，有着决定性的意义。</p>
<p>一般来说，数据模型的建设主要能够帮助我们解决以下的一些问题：</p>
<ol>
<li>进行全面的业务梳理，改进业务流程。在业务模型建设的阶段，能够帮助我们的企业或者是管理机关对本单位的业务进行全面的梳理。通过业务模型的建设，我们应该能够全面了解该单位的业务架构图和整个业务的运行情况，能够将业务按照特定的规律进行分门别类和程序化，同时，帮助我们进一步的改进业务的流程，提高业务效率，指导我们的业务部门的生产。</li>
<li>建立全方位的数据视角，消灭信息孤岛和数据差异。通过数据仓库的模型建设，能够为企业提供一个整体的数据视角，不再是各个部门只是关注自己的数据，而且通过模型的建设，勾勒出了部门之间内在的联系，帮助消灭各个部门之间的信息孤岛的问题，更为重要的是，通过数据模型的建设，能够保证整个企业的数据的一致性，各个部门之间数据的差异将会得到有效解决。</li>
<li>解决业务的变动和数据仓库的灵活性。通过数据模型的建设，能够很好的分离出底层技术的实现和上层业务的展现。当上层业务发生变化时，通过数据模型，底层的技术实现可以非常轻松的完成业务的变动，从而达到整个数据仓库系统的灵活性。</li>
<li>帮助数据仓库系统本身的建设。通过数据仓库的模型建设，开发人员和业务人员能够很容易的达成系统建设范围的界定，以及长期目标的规划，从而能够使整个项目组明确当前的任务，加快整个系统建设的速度。</li>
</ol>
<h1 id="如何建设数据仓库模型"><a href="#如何建设数据仓库模型" class="headerlink" title="如何建设数据仓库模型"></a>如何建设数据仓库模型</h1><p>建设数据模型既然是整个数据仓库建设中一个非常重要的关键部分，那么，怎么建设我们的数据仓库模型就是我们需要解决的一个问题。这里我们将要详细介绍如何创建适合自己的数据模型。</p>
<h2 id="数据仓库数据模型架构"><a href="#数据仓库数据模型架构" class="headerlink" title="数据仓库数据模型架构"></a>数据仓库数据模型架构</h2><p>数据仓库的数据模型的架构和数据仓库的整体架构是紧密关联在一起的，我们首先来了解一下整个数据仓库的数据模型应该包含的几个部分。从下图我们可以很清楚地看到，整个数据模型的架构分成 5 大部分，每个部分其实都有其独特的功能。</p>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/10-Data-Warehouse-Model-Architecture.png?raw=true" alt="10-Data-Warehouse-Model-Architecture"></p>
<p>从上图我们可以看出，整个数据仓库的数据模型可以分为大概 5 大部分：</p>
<ol>
<li>系统记录域（System of Record）：这部分是主要的数据仓库业务数据存储区，数据模型在这里保证了数据的一致性。</li>
<li>内部管理域（Housekeeping）：这部分主要存储数据仓库用于内部管理的元数据，数据模型在这里能够帮助进行统一的元数据的管理。</li>
<li>汇总域（Summary of Area）：这部分数据来自于系统记录域的汇总，数据模型在这里保证了分析域的主题分析的性能，满足了部分的报表查询。</li>
<li>分析域（Analysis Area）：这部分数据模型主要用于各个业务部分的具体的主题业务分析。这部分数据模型可以单独存储在相应的数据集市中。</li>
<li>反馈域（Feedback Area）：可选项，这部分数据模型主要用于相应前端的反馈数据，数据仓库可以视业务的需要设置这一区域。</li>
</ol>
<p>通过对整个数据仓库模型的数据区域的划分，我们可以了解到，一个好的数据模型，不仅仅是对业务进行抽象划分，而且对实现技术也进行具体的指导，它应该涵盖了从业务到实现技术的各个部分。</p>
<h2 id="数据仓库建模阶段划分"><a href="#数据仓库建模阶段划分" class="headerlink" title="数据仓库建模阶段划分"></a>数据仓库建模阶段划分</h2><p>我们前面介绍了数据仓库模型的几个层次，下面我们讲一下，针对这几个层次的不同阶段的数据建模的工作的主要内容：</p>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/11-Data-Warehouse-Model-Hierarchy.png?raw=true" alt="11-Data-Warehouse-Model-Hierarchy"></p>
<h3 id="业务建模"><a href="#业务建模" class="headerlink" title="业务建模"></a>业务建模</h3><ol>
<li>划分整个单位的业务，一般按照业务部门的划分，进行各个部分之间业务工作的界定，理清各业务部门之间的关系。</li>
<li>深入了解各个业务部门的内具体业务流程并将其程序化。</li>
<li>提出修改和改进业务部门工作流程的方法并程序化。</li>
<li>数据建模的范围界定，整个数据仓库项目的目标和阶段划分。</li>
</ol>
<h3 id="领域概念建模"><a href="#领域概念建模" class="headerlink" title="领域概念建模"></a>领域概念建模</h3><ol>
<li>抽取关键业务概念，并将之抽象化。</li>
<li>将业务概念分组，按照业务主线聚合类似的分组概念。</li>
<li>细化分组概念，理清分组概念内的业务流程并抽象化。</li>
<li>理清分组概念之间的关联，形成完整的领域概念模型。</li>
</ol>
<h3 id="逻辑建模"><a href="#逻辑建模" class="headerlink" title="逻辑建模"></a>逻辑建模</h3><ol>
<li>业务概念实体化，并考虑其具体的属性。</li>
<li>事件实体化，并考虑其属性内容。</li>
<li>说明实体化，并考虑其属性内容。</li>
</ol>
<h3 id="物理建模"><a href="#物理建模" class="headerlink" title="物理建模"></a>物理建模</h3><ol>
<li>针对特定物理化平台，做出相应的技术调整。</li>
<li>针对模型的性能考虑，对特定平台作出相应的调整。</li>
<li>针对管理的需要，结合特定的平台，做出相应的调整。</li>
<li>生成最后的执行脚本，并完善之。</li>
</ol>
<p>从我们上面对数据仓库的数据建模阶段的各个阶段的划分，我们能够了解到整个数据仓库建模的主要工作和工作量，希望能够对我们在实际的项目建设能够有所帮助。</p>
<h2 id="数据仓库建模方法"><a href="#数据仓库建模方法" class="headerlink" title="数据仓库建模方法"></a>数据仓库建模方法</h2><p>大千世界，表面看五彩缤纷，实质上，万物都遵循其自有的法则。数据仓库的建模方法同样也有很多种，每一种建模方法其实代表了哲学上的一个观点，代表了一种归纳，概括世界的一种方法。目前业界较为流行的数据仓库的建模方法非常多，这里主要介绍范式建模法，维度建模法，实体建模法等几种方法，每种方法其实从本质上讲就是从不同的角度看我们业务中的问题，不管从技术层面还是业务层面，其实代表的是哲学上的一种世界观。我们下面给大家详细介绍一下这些建模方法。</p>
<h3 id="范式建模法"><a href="#范式建模法" class="headerlink" title="范式建模法"></a>范式建模法</h3><p>范式建模法（Third Normal Form，3NF）：范式建模法其实是我们在构建数据模型常用的一个方法，该方法的主要由 Inmon 所提倡，主要解决关系型数据库得数据存储，利用的一种技术层面上的方法。目前，我们在关系型数据库中的建模方法，大部分采用的是三范式建模法。<br>范式是数据库逻辑模型设计的基本理论，一个关系模型可以从第一范式到第五范式进行无损分解，这个过程也可称为规范化。在数据仓库的模型设计中目前一般采用第三范式，它有着严格的数学定义。从其表达的含义来看，一个符合第三范式的关系必须具有以下三个条件 :</p>
<ol>
<li>每个属性值唯一，不具有多义性 ;</li>
<li>每个非主属性必须完全依赖于整个主键，而非主键的一部分 ;</li>
<li>每个非主属性不能依赖于其他关系中的属性，因为这样的话，这种属性应该归到其他关系中去。</li>
</ol>
<p>由于范式是基于整个关系型数据库的理论基础之上发展而来的，因此，本人在这里不多做介绍，有兴趣的读者可以通过阅读相应的材料来获得这方面的知识。<br>根据 Inmon 的观点，数据仓库模型得建设方法和业务系统的企业数据模型类似。在业务系统中，企业数据模型决定了数据的来源，而企业数据模型也分为两个层次，即主题域模型和逻辑模型。同样，主题域模型可以看成是业务模型的概念模型，而逻辑模型则是域模型在关系型数据库上的实例。</p>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/12-Business-And-DW.png?raw=true" alt="12-Business-And-DW"></p>
<p>从业务数据模型转向数据仓库模型时，同样也需要有数据仓库的域模型，即概念模型，同时也存在域模型的逻辑模型。这里，业务模型中的数据模型和数据仓库的模型稍微有一些不同。主要区别在于：</p>
<ul>
<li>数据仓库的域模型应该包含企业数据模型的域模型之间的关系，以及各主题域定义。数据仓库的域模型的概念应该比业务系统的主题域模型范围更加广。</li>
<li>在数据仓库的逻辑模型需要从业务系统的数据模型中的逻辑模型中抽象实体，实体的属性，实体的子类，以及实体的关系等。</li>
</ul>
<p>Inmon 的范式建模法的最大优点就是从关系型数据库的角度出发，结合了业务系统的数据模型，能够比较方便的实现数据仓库的建模。但其缺点也是明显的，由于建模方法限定在关系型数据库之上，在某些时候反而限制了整个数据仓库模型的灵活性，性能等，特别是考虑到数据仓库的底层数据向数据集市的数据进行汇总时，需要进行一定的变通才能满足相应的需求。因此，笔者建议读者们在实际的使用中，参考使用这一建模方式。</p>
<h3 id="维度建模法"><a href="#维度建模法" class="headerlink" title="维度建模法"></a>维度建模法</h3><p>维度建模法，Kimball 最先提出这一概念。其最简单的描述就是，按照事实表，维表来构建数据仓库，数据集市。这种方法的最被人广泛知晓的名字就是星型模式（Star-schema）。</p>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/13-Dimension-Of-DW.png?raw=true" alt="13-Dimension-Of-DW"></p>
<p>上图的这个架构中是典型的星型架构。星型模式之所以广泛被使用，在于针对各个维作了大量的预处理，如按照维进行预先的统计、分类、排序等。通过这些预处理，能够极大的提升数据仓库的处理能力。特别是针对 3NF 的建模方法，星型模式在性能上占据明显的优势。<br>同时，维度建模法的另外一个优点是，维度建模非常直观，紧紧围绕着业务模型，可以直观的反映出业务模型中的业务问题。不需要经过特别的抽象处理，即可以完成维度建模。这一点也是维度建模的优势。<br>但是，维度建模法的缺点也是非常明显的，由于在构建星型模式之前需要进行大量的数据预处理，因此会导致大量的数据处理工作。而且，当业务发生变化，需要重新进行维度的定义时，往往需要重新进行维度数据的预处理。而在这些与处理过程中，往往会导致大量的数据冗余。<br>另外一个维度建模法的缺点就是，如果只是依靠单纯的维度建模，不能保证数据来源的一致性和准确性，而且在数据仓库的底层，不是特别适用于维度建模的方法。<br>因此以笔者的观点看，维度建模的领域主要适用与数据集市层，它的最大的作用其实是为了解决数据仓库建模中的性能问题。维度建模很难能够提供一个完整地描述真实业务实体之间的复杂关系的抽象方法。</p>
<h3 id="实体建模法"><a href="#实体建模法" class="headerlink" title="实体建模法"></a>实体建模法</h3><p>实体建模法并不是数据仓库建模中常见的一个方法，它来源于哲学的一个流派。从哲学的意义上说，客观世界应该是可以细分的，客观世界应该可以分成由一个个实体，以及实体与实体之间的关系组成。那么我们在数据仓库的建模过程中完全可以引入这个抽象的方法，将整个业务也可以划分成一个个的实体，而每个实体之间的关系，以及针对这些关系的说明就是我们数据建模需要做的工作。<br>虽然实体法粗看起来好像有一些抽象，其实理解起来很容易。即我们可以将任何一个业务过程划分成 3 个部分，实体，事件和说明，如下图所示：</p>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/14-Entity-Of-Model.png?raw=true" alt="14-Entity-Of-Model"></p>
<p>上图表述的是一个抽象的含义，如果我们描述一个简单的事实：“小明开车去学校上学”。以这个业务事实为例，我们可以把“小明”，“学校”看成是一个实体，“上学”描述的是一个业务过程，我们在这里可以抽象为一个具体“事件”，而“开车去”则可以看成是事件“上学”的一个说明。<br>从上面的举例我们可以了解，我们使用的抽象归纳方法其实很简单，任何业务可以看成 3 个部分：</p>
<ul>
<li>实体，主要指领域模型中特定的概念主体，指发生业务关系的对象。</li>
<li>事件，主要指概念主体之间完成一次业务流程的过程，特指特定的业务过程。</li>
<li>说明，主要是针对实体和事件的特殊说明。</li>
</ul>
<p>由于实体建模法，能够很轻松的实现业务模型的划分，因此，在业务建模阶段和领域概念建模阶段，实体建模法有着广泛的应用。从笔者的经验来看，再没有现成的行业模型的情况下，我们可以采用实体建模的方法，和客户一起理清整个业务的模型，进行领域概念模型的划分，抽象出具体的业务概念，结合客户的使用特点，完全可以创建出一个符合自己需要的数据仓库模型来。<br>但是，实体建模法也有着自己先天的缺陷，由于实体说明法只是一种抽象客观世界的方法，因此，注定了该建模方法只能局限在业务建模和领域概念建模阶段。因此，到了逻辑建模阶段和物理建模阶段，则是范式建模和维度建模发挥长处的阶段。<br>因此，笔者建议读者在创建自己的数据仓库模型的时候，可以参考使用上述的三种数据仓库得建模方法，在各个不同阶段采用不同的方法，从而能够保证整个数据仓库建模的质量。</p>
<h1 id="维度建模"><a href="#维度建模" class="headerlink" title="维度建模"></a>维度建模</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>在多维分析的商业智能解决方案中，根据事实表和维度表的关系，又可将常见的模型分为星型模型和雪花型模型。在设计逻辑型数据的模型的时候，就应考虑数据是按照星型模型还是雪花型模型进行组织。<br>当所有维表都直接连接到“ 事实表”上时，整个图解就像星星一样，故将该模型称为星型模型，如图 1 。<br>星型架构是一种非正规化的结构，多维数据集的每一个维度都直接与事实表相连接，不存在渐变维度，所以数据有一定的冗余，如在地域维度表中，存在国家 A 省 B 的城市 C 以及国家 A 省 B 的城市 D 两条记录，那么国家 A 和省 B 的信息分别存储了两次，即存在冗余。</p>
<p>销售数据仓库中的星型模型：</p>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/15-Star-Model.png?raw=true" alt="15-Star-Model"></p>
<p>当有一个或多个维表没有直接连接到事实表上，而是通过其他维表连接到事实表上时，其图解就像多个雪花连接在一起，故称雪花模型。雪花模型是对星型模型的扩展。它对星型模型的维表进一步层次化，原有的各维表可能被扩展为小的事实表，形成一些局部的 “ 层次 “ 区域，这些被分解的表都连接到主维度表而不是事实表。如图 2，将地域维表又分解为国家，省份，城市等维表。它的优点是 : 通过最大限度地减少数据存储量以及联合较小的维表来改善查询性能。雪花型结构去除了数据冗余。<br>销售数据仓库中的雪花型模型：</p>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/16-Snowflake-Model.png?raw=true" alt="16-Snowflake-Model"></p>
<p>星型模型因为数据的冗余所以很多统计查询不需要做外部的连接，因此一般情况下效率比雪花型模型要高。星型结构不用考虑很多正规化的因素，设计与实现都比较简单。雪花型模型由于去除了冗余，有些统计就需要通过表的联接才能产生，所以效率不一定有星型模型高。正规化也是一种比较复杂的过程，相应的数据库结构设计、数据的 ETL、以及后期的维护都要复杂一些。因此在冗余可以接受的前提下，实际运用中星型模型使用更多，也更有效率。</p>
<h2 id="使用选择"><a href="#使用选择" class="headerlink" title="使用选择"></a>使用选择</h2><p>星形模型(Star Schema)和雪花模型(Snowflake Schema)是数据仓库中常用到的两种方式，而它们之间的对比要从四个角度来进行讨论。</p>
<h3 id="数据优化"><a href="#数据优化" class="headerlink" title="数据优化"></a>数据优化</h3><p>雪花模型使用的是规范化数据，也就是说数据在数据库内部是组织好的，以便消除冗余，因此它能够有效地减少数据量。通过引用完整性，其业务层级和维度都将存储在数据模型之中。</p>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/17-Snowflake-Model.png?raw=true" alt="17-Snowflake-Model"></p>
<p>相比较而言，星形模型实用的是反规范化数据。在星形模型中，维度直接指的是事实表，业务层级不会通过维度之间的参照完整性来部署。</p>
<p><img src="https://github.com/onefansofworld/hexo_images/blob/master/Data-Warehouse/18-Star-Model.png?raw=true" alt="18-Star-Model"></p>
<h3 id="业务模型"><a href="#业务模型" class="headerlink" title="业务模型"></a>业务模型</h3><p>主键是一个单独的唯一键(数据属性)，为特殊数据所选择。在上面的例子中，Advertiser_ID就将是一个主键。外键(参考属性)仅仅是一个表中的字段，用来匹配其他维度表中的主键。在我们所引用的例子中，Advertiser_ID将是Account_dimension的一个外键。<br>在雪花模型中，数据模型的业务层级是由一个不同维度表主键-外键的关系来代表的。而在星形模型中，所有必要的维度表在事实表中都只拥有外键。</p>
<h3 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h3><p>第三个区别在于性能的不同。雪花模型在维度表、事实表之间的连接很多，因此性能方面会比较低。举个例子，如果你想要知道Advertiser 的详细信息，雪花模型就会请求许多信息，比如Advertiser Name、ID以及那些广告主和客户表的地址需要连接起来，然后再与事实表连接。<br>而星形模型的连接就少的多，在这个模型中，如果你需要上述信息，你只要将Advertiser的维度表和事实表连接即可。</p>
<h3 id="ETL"><a href="#ETL" class="headerlink" title="ETL"></a>ETL</h3><p>雪花模型加载数据集市，因此ETL操作在设计上更加复杂，而且由于附属模型的限制，不能并行化。<br>星形模型加载维度表，不需要再维度之间添加附属模型，因此ETL就相对简单，而且可以实现高度的并行化。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>雪花模型使得维度分析更加容易，比如“针对特定的广告主，有哪些客户或者公司是在线的?”星形模型用来做指标分析更适合，比如“给定的一个客户他们的收入是多少?”</p>
<h2 id="缓慢变化维"><a href="#缓慢变化维" class="headerlink" title="缓慢变化维"></a>缓慢变化维</h2><p>维度建模的数据仓库中，有一个概念叫 Slowly Changing Dimensions, 中文一般翻译成”缓慢变化维“，经常被简写为 SCD. 缓慢变化维的提出是因为在现实世界中，维度的属性并不是静态的，它会随着时间的流失发生缓慢的变化。这种随着时间发生变化的维度我们一般称之为缓慢变化维，并且把处理温度表的历史变化信息的问题称为处理缓慢变化维问题，有时也简称为处理 SCD 的问题。</p>
<p>如何解决缓慢变化维带来的影响？</p>
<h3 id="第一种方法"><a href="#第一种方法" class="headerlink" title="第一种方法"></a>第一种方法</h3><p>直接在原来维度的基础上进行更新，不会产生新的记录。</p>
<p>更新前：</p>
<table>
<thead>
<tr>
<th style="text-align:center">emp_rid</th>
<th style="text-align:center">emp_id</th>
<th style="text-align:center">emp_name</th>
<th style="text-align:center">position</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">101212</td>
<td style="text-align:center">12345</td>
<td style="text-align:center">Jack</td>
<td style="text-align:center">Developer</td>
</tr>
</tbody>
</table>
<p>更新后：</p>
<table>
<thead>
<tr>
<th style="text-align:center">emp_rid</th>
<th style="text-align:center">emp_id</th>
<th style="text-align:center">emp_name</th>
<th style="text-align:center">position</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">101212</td>
<td style="text-align:center">12345</td>
<td style="text-align:center">Jack</td>
<td style="text-align:center">Manager</td>
</tr>
</tbody>
</table>
<p>position 发生变化。</p>
<h3 id="第二种方法"><a href="#第二种方法" class="headerlink" title="第二种方法"></a>第二种方法</h3><p>不修改原有的数据，重新产生一条新的记录，这样就可以追溯所有的历史记录。</p>
<p>更新前：</p>
<table>
<thead>
<tr>
<th style="text-align:center">emp_rid</th>
<th style="text-align:center">emp_id</th>
<th style="text-align:center">emp_name</th>
<th style="text-align:center">position</th>
<th style="text-align:center">start_date</th>
<th style="text-align:center">end_date</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">101212</td>
<td style="text-align:center">12345</td>
<td style="text-align:center">Jack</td>
<td style="text-align:center">Developer</td>
<td style="text-align:center">2010-02-05</td>
<td style="text-align:center">2012-06-12</td>
</tr>
</tbody>
</table>
<p>更新后：</p>
<table>
<thead>
<tr>
<th style="text-align:center">emp_rid</th>
<th style="text-align:center">emp_id</th>
<th style="text-align:center">emp_name</th>
<th style="text-align:center">position</th>
<th style="text-align:center">start_date</th>
<th style="text-align:center">end_date</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">101212</td>
<td style="text-align:center">12345</td>
<td style="text-align:center">Jack</td>
<td style="text-align:center">Manager</td>
<td style="text-align:center">2012-06-12</td>
</tr>
</tbody>
</table>
<p>新增了一条记录。</p>
<h3 id="第三种方法"><a href="#第三种方法" class="headerlink" title="第三种方法"></a>第三种方法</h3><p>直接在原来维度的基础上进行更新，不会产生新的记录但是会记录上一次的。</p>
<p>更新前：</p>
<table>
<thead>
<tr>
<th style="text-align:center">emp_rid</th>
<th style="text-align:center">emp_id</th>
<th style="text-align:center">emp_name</th>
<th style="text-align:center">position</th>
<th style="text-align:center">old_position</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">101212</td>
<td style="text-align:center">12345</td>
<td style="text-align:center">Jack</td>
<td style="text-align:center">Developer</td>
<td style="text-align:center">null</td>
</tr>
</tbody>
</table>
<p>更新后：</p>
<table>
<thead>
<tr>
<th style="text-align:center">emp_rid</th>
<th style="text-align:center">emp_id</th>
<th style="text-align:center">emp_name</th>
<th style="text-align:center">position</th>
<th style="text-align:center">old_position</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">101212</td>
<td style="text-align:center">12345</td>
<td style="text-align:center">Jack</td>
<td style="text-align:center">Manager</td>
<td style="text-align:center">Developer</td>
</tr>
</tbody>
</table>
<p>多一个字段，用来存放以前的 position.</p>
<p>End.</p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>您的支持将鼓励我继续创作</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="moqi 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="moqi 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Data-Warehouse/" rel="tag"># Data-Warehouse</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/08/10/Spark-SQL-Analysis/" rel="next" title="Spark SQL 应用解析">
                <i class="fa fa-chevron-left"></i> Spark SQL 应用解析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/08/21/Spark-Streaming-Analysis/" rel="prev" title="Spark Streaming 应用解析">
                Spark Streaming 应用解析 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://avatars3.githubusercontent.com/u/39821951?s=400&u=65c6d8145d7b591ca2051e7082fd842b56e62567&v=4"
                alt="moqi" />
            
              <p class="site-author-name" itemprop="name">moqi</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:moqimoqidea@gmail.com" target="_blank" title="E-mail">
                      
                        <i class="fa fa-fw fa-meh-o"></i>E-mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#什么是数据仓库"><span class="nav-number">1.</span> <span class="nav-text">什么是数据仓库</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据仓库的特点"><span class="nav-number">2.</span> <span class="nav-text">数据仓库的特点</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据是面向主题的"><span class="nav-number">2.1.</span> <span class="nav-text">数据是面向主题的</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据是集成的"><span class="nav-number">2.2.</span> <span class="nav-text">数据是集成的</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据是不可更新的"><span class="nav-number">2.3.</span> <span class="nav-text">数据是不可更新的</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据是随时间不断变化的"><span class="nav-number">2.4.</span> <span class="nav-text">数据是随时间不断变化的</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据仓库的发展历程"><span class="nav-number">3.</span> <span class="nav-text">数据仓库的发展历程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简单报表阶段"><span class="nav-number">3.1.</span> <span class="nav-text">简单报表阶段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据集市阶段"><span class="nav-number">3.2.</span> <span class="nav-text">数据集市阶段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据仓库阶段"><span class="nav-number">3.3.</span> <span class="nav-text">数据仓库阶段</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据仓库和数据库的区别"><span class="nav-number">4.</span> <span class="nav-text">数据仓库和数据库的区别</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据仓库架构分层"><span class="nav-number">5.</span> <span class="nav-text">数据仓库架构分层</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ODS层"><span class="nav-number">5.1.</span> <span class="nav-text">ODS层</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PDW层"><span class="nav-number">5.2.</span> <span class="nav-text">PDW层</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DM层"><span class="nav-number">5.3.</span> <span class="nav-text">DM层</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#APP层"><span class="nav-number">5.4.</span> <span class="nav-text">APP层</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#为什么要对数据仓库分层"><span class="nav-number">5.5.</span> <span class="nav-text">为什么要对数据仓库分层</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据质量检查"><span class="nav-number">6.</span> <span class="nav-text">数据质量检查</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#元数据介绍"><span class="nav-number">7.</span> <span class="nav-text">元数据介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#元数据的定义"><span class="nav-number">7.1.</span> <span class="nav-text">元数据的定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#元数据的存储方式"><span class="nav-number">7.2.</span> <span class="nav-text">元数据的存储方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#元数据的作用"><span class="nav-number">7.3.</span> <span class="nav-text">元数据的作用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#什么是数据模型"><span class="nav-number">8.</span> <span class="nav-text">什么是数据模型</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#为什么需要数据模型"><span class="nav-number">9.</span> <span class="nav-text">为什么需要数据模型</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#如何建设数据仓库模型"><span class="nav-number">10.</span> <span class="nav-text">如何建设数据仓库模型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据仓库数据模型架构"><span class="nav-number">10.1.</span> <span class="nav-text">数据仓库数据模型架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据仓库建模阶段划分"><span class="nav-number">10.2.</span> <span class="nav-text">数据仓库建模阶段划分</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#业务建模"><span class="nav-number">10.2.1.</span> <span class="nav-text">业务建模</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#领域概念建模"><span class="nav-number">10.2.2.</span> <span class="nav-text">领域概念建模</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#逻辑建模"><span class="nav-number">10.2.3.</span> <span class="nav-text">逻辑建模</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#物理建模"><span class="nav-number">10.2.4.</span> <span class="nav-text">物理建模</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据仓库建模方法"><span class="nav-number">10.3.</span> <span class="nav-text">数据仓库建模方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#范式建模法"><span class="nav-number">10.3.1.</span> <span class="nav-text">范式建模法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#维度建模法"><span class="nav-number">10.3.2.</span> <span class="nav-text">维度建模法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实体建模法"><span class="nav-number">10.3.3.</span> <span class="nav-text">实体建模法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#维度建模"><span class="nav-number">11.</span> <span class="nav-text">维度建模</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#概述"><span class="nav-number">11.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用选择"><span class="nav-number">11.2.</span> <span class="nav-text">使用选择</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据优化"><span class="nav-number">11.2.1.</span> <span class="nav-text">数据优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#业务模型"><span class="nav-number">11.2.2.</span> <span class="nav-text">业务模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#性能"><span class="nav-number">11.2.3.</span> <span class="nav-text">性能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ETL"><span class="nav-number">11.2.4.</span> <span class="nav-text">ETL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">11.2.5.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缓慢变化维"><span class="nav-number">11.3.</span> <span class="nav-text">缓慢变化维</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#第一种方法"><span class="nav-number">11.3.1.</span> <span class="nav-text">第一种方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第二种方法"><span class="nav-number">11.3.2.</span> <span class="nav-text">第二种方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第三种方法"><span class="nav-number">11.3.3.</span> <span class="nav-text">第三种方法</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">moqi</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">68.6k</span>
  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://moqimoqidea.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://moqimoqidea.github.io/2017/08/13/Data-Warehouse-Construction/';
          this.page.identifier = '2017/08/13/Data-Warehouse-Construction/';
          this.page.title = '数据仓库建设';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://moqimoqidea.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('3');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
